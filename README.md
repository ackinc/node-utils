# node-utils

A collection of utility functions I find myself needing across multiple projects

Functions can be `required` individually like so: `const fn = require('@ack_inc/utils/lib/<fn-name-in-kebab-case>')`

## Docs

### generateRandomString(nChars, constraints)

Generates a string of length `nChars` that satisfies `constraints`

Use case: password or temporary token generation

#### Parameters

###### nChars

| Type   | Required? | Description                          | Comments                |
| ------ | --------- | ------------------------------------ | ----------------------- |
| number | Y         | The length of the string to generate | Must be a whole number. |

###### constraints

| Type   | Required? | Description                                                       | Comments |
| ------ | --------- | ----------------------------------------------------------------- | -------- |
| object | Y         | Object specifying what characters can be in the generated string. |          |

The object may have the following keys:

| Key       | Type    | Effect                                  |
| --------- | ------- | --------------------------------------- |
| lowercase | Boolean | if `true`, include lowercase characters |
| uppercase | Boolean | if `true`, include uppercase chracters  |
| digits    | Boolean | if `true`, include digits               |
| symbols   | Boolean | if `true`, include symbols              |

If `constraints` is not provided or is empty, it is assumed that all characters are allowed

Look in `lib/generate-random-string.js` for the full list of symbols

#### Return value

| Type   | Description       |
| ------ | ----------------- |
| string | The random string |

#### Usage

```
const {generateRandomString: rsg} = require('@ack_inc/utils');
console.log(rsg(<anything but a whole number>)); //=> throws TypeError
console.log(rsg(0)); //=> ""
console.log(rsg(5)); //=> "3`8aE"
console.log(rsg(5, { lowercase: true })); //=> "fewjk"
console.log(rsg(5, { lowercase: true, uppercase: true, digits: true, symbols: true })); //=> "%q31G"
```

### groupByMultiKeys(records, getKeys)

Group an array of records into sub-groups. Records go into the same sub-group if any of the keys generated by getKeys are `===` equal

Use case: you are merging records (of people, say) from multiple sources, and want to group two records as belonging to the same person if any of several different "identifiers" (email, phone number, social media handle, etc.) match

#### Parameters

###### records

| Type          | Required? | Description               | Comments                                                   |
| ------------- | --------- | ------------------------- | ---------------------------------------------------------- |
| Array<object> | Y         | Array of records to group | Throws TypeError if not an array with at least one element |

###### getKeys

| Type     | Required? | Description                               | Comments                                                                                                                                                      |
| -------- | --------- | ----------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Function | Y         | Function to generate keys for each record | Should takes a record as the sole param, and returns an array of keys that function as "record identifiers"; signature is `getKeys(record: object): Array<T>` |

#### Return value

| Type                 | Description                                                                                     |
| -------------------- | ----------------------------------------------------------------------------------------------- |
| Array<Array<object>> | Each element of the returned array is a sub-group of records for which at least one key matched |

It may not be the case that there is a common key for all the records in a sub-group. Further, there may be two records in a sub-group that have no keys in common. For example, the following three records will be in the same sub-group, through `A` and `C` do not have a common key:

- Record `A` with keys `a` and `b`
- Record `B` with keys `b` and `c`
- Record `C` with key `c`

#### Usage

See the tests in `lib/group-by-multi-keys.test.js` for usage examples

## To Do

- generateRandomString

  - Constraint: whitelisted chars
  - Constraint: blacklisted chars
  - Constraint: symbols that can be part of a url-component (See https://stackoverflow.com/questions/695438/what-are-the-safe-characters-for-making-urls)

- groupByMultiKeys

  - ensure temporary attrs added to records don't overwrite an existing key
